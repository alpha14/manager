<oui-stepper
    data-current-index="$ctrl.currentIndex"
    data-on-finish="$ctrl.validateCheckout()"
>
    <div data-ng-transclude></div>

    <oui-step-form
        data-header="{{:: 'wuc_order_pricing_header' | translate }}"
        data-editable="$ctrl.pricings.length > 1 && !$ctrl.loading.getCheckoutInformations && !$ctrl.loading.validateCheckout"
        data-valid="$ctrl.pricing"
        data-prevent-next="true"
        data-on-focus="$ctrl.getPricings()"
    >
        <div class="mb-3" data-ng-if="$ctrl.hasUniquePricing()">
            <span
                data-ng-pluralize
                data-count="$ctrl.pricings[0].interval"
                data-when="{
                  'one': ('wuc_order_pricing_' + $ctrl.pricings[0].intervalUnit | translate:{ number: $ctrl.pricings[0].interval }),
                  'other': ('wuc_order_pricing_' + $ctrl.pricings[0].intervalUnit + 's' | translate:{ number: $ctrl.pricings[0].interval }),
                }"
                data-ng-if="$ctrl.pricings[0].interval !== 0"
            ></span>
            <ovh-manager-order-catalog-price
                data-price="$ctrl.pricings[0].price"
                data-tax="$ctrl.pricings[0].tax"
                data-user="$ctrl.user"
            >
            </ovh-manager-order-catalog-price>
        </div>

        <oui-radio
            data-ng-if="!$ctrl.hasUniquePricing()"
            data-ng-repeat="pricing in $ctrl.pricings track by pricing.description"
            data-name="pricing"
            data-model="$ctrl.pricing"
            data-value="pricing"
        >
            <span
                data-ng-if="pricing.interval !== 0"
                data-translate="wuc_order_pricing_duration"
                data-translate-values="{
                duration: ('wuc_order_pricing_' + pricing.intervalUnit + (pricing.interval === 1 ? '' : 's') | translate:{ number: pricing.interval })
              }"
            ></span>

            <ovh-manager-order-catalog-price
                data-price="pricing.price"
                data-tax="pricing.tax"
                data-user="$ctrl.user"
            >
            </ovh-manager-order-catalog-price>
        </oui-radio>
    </oui-step-form>
    <oui-step-form
        data-header="{{:: 'wuc_order_confirmation_header' | translate }}"
        data-editable="!$ctrl.loading.getCheckoutInformations || !$ctrl.loading.validateCheckout"
        data-valid="(
          (!$ctrl.isFreePricing() && $ctrl.confirmation.autoPayWithPreferredPaymentMethod != null)
          || $ctrl.isFreePricing()
          ) && $ctrl.confirmation.agreeContracts"
        data-on-focus="$ctrl.prepareCheckout()"
        data-prevent-next
        data-submit-text="{{:: ($ctrl.isFreePricing() ? 'wuc_order_confirmation_activate' : 'wuc_order_confirmation_pay') | translate }}"
        data-loading="$ctrl.loading.getCheckoutInformations || $ctrl.loading.validateCheckout"
        data-on-submit="$ctrl.goToEnd()"
    >
        <div data-ng-if="!$ctrl.isFreePricing()">
            <div class="row">
                <dl
                    class="oui-description oui-description_horizontal oui-heading_underline col-md-2"
                >
                    <dt data-translate="wuc_order_total_price_without_tax"></dt>
                    <dd
                        data-ng-bind="$ctrl.confirmation.prices.withoutTax.text"
                    ></dd>
                    <dt data-translate="wuc_order_total_price_with_tax"></dt>
                    <dd
                        data-ng-bind="$ctrl.confirmation.prices.withTax.text"
                    ></dd>
                    <div data-ng-if="$ctrl.pricing.interval !== 0">
                        <dt data-translate="wuc_order_duration"></dt>
                        <dd
                            data-ng-bind="('wuc_order_pricing_' + $ctrl.pricing.intervalUnit + ($ctrl.pricing.interval === 1 ? '' : 's') | translate:{ number: $ctrl.pricing.interval })"
                        ></dd>
                    </div>
                </dl>
            </div>

            <ovh-payment-method-choice
                data-model="$ctrl.confirmation.autoPayWithPreferredPaymentMethod"
            >
            </ovh-payment-method-choice>
        </div>

        <ovh-contracts-summary
            data-items="$ctrl.confirmation.contracts"
            data-model="$ctrl.confirmation.agreeContracts"
        >
        </ovh-contracts-summary>
    </oui-step-form>
</oui-stepper>
